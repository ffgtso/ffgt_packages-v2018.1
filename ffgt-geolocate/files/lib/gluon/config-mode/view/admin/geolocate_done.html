<%#
Copyright 2008 Steven Barth <steven@midlink.org>
Copyright 2008-2009 Jo-Philipp Wich <xm@subsignal.org>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

	http://www.apache.org/licenses/LICENSE-2.0

$Id$

-%>
<%
local util = require 'gluon.util'
local fs = require 'nixio.fs'
local site = require 'gluon.site'
local uci = require("simple-uci").cursor()
%>
<h2><%:Geolocation successfull%></h2>

<%
local location = uci:get_first("gluon-node-info", "location")
local lat = uci:get_first("gluon-node-info", 'location', "latitude")
local lon = uci:get_first("gluon-node-info", 'location', "longitude")
local unlocode = uci:get_first("gluon-node-info", "location", "locode")
if not lat then lat=0 end
if not lon then lon=0 end
if (lat == "51.892825") and (lon == "8.383708") then lat=51 lon=9 end
%><!-- Lat: <%=lat%> Lon: <%=lon%> locode: <%=unnoclode%> --><%
local addr = uci:get_first("gluon-node-info", 'location', "addr") or "FEHLER_ADDR"
local city = uci:get_first("gluon-node-info", 'location', "city") or "FEHLER_ORT"
local zip = uci:get_first("gluon-node-info", 'location', "zip") or "00000"
local communityname = string.gsub(util.exec(string.format("/lib/gluon/ffgt-geolocate/get_domain_name.sh %s", unlocode)),"\n", "")
local mystr = string.format("<b>Adresse:</b> %s, %s %s<br></br><b>Koordinaten:</b> %f %f<br></br><b>Community:</b> %s", addr, zip, city, lat, lon, communityname)
local text = translate('Your node will be registered running at:')
  text = text .. '<div><br></br></div>' .. mystr
  write(text) %>
	<p>
		<%:If neccessary, please go back to Geolocation.%>
	</p>
